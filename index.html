<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ball</title>
    <style>
        * {
            margin: 0;
        }

        canvas {
            border: 5px solid white;
            display:block;
            margin: 0;
        }

        #fullScreenButton {
            position: absolute;
            font-size: 20px;
            padding: 10px;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
        }
    </style>
</head>
<body>
    <canvas></canvas>
    <button id="fullScreenButton">Fullscreen</button>
    <audio id="victory" src="pointbell.wav"></audio>

    <script>
        var canvas = document.querySelector('canvas');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        const ctx = canvas.getContext('2d');
        let lastTime;
        let gameOver = false;
        let gameStarted = false;

        const fullScreenButton = document.getElementById("fullScreenButton");

        const ball = {
            x: 50,
            y: canvas.height / 2,
            radius: 20,
            speed: 5,
            acceleration: 0.05,
            directionX: 0,
            directionY: 0,

            draw: function() {
                ctx.save();
                ctx.translate(this.x, this.y);
                
                ctx.beginPath();
                ctx.arc(0, 0, this.radius, 0, Math.PI * 2)
                ctx.fillStyle = 'white';
                ctx.fill();

                ctx.restore();
            },

            move: function(dx, dy) {
                this.directionX += (dx - this.directionX) * this.acceleration;
                this.directionY += (dy - this.directionY) * this.acceleration;
            },

            update: function() {
                this.x += this.directionX * this.speed;
                this.y += this.directionY * this.speed;

                if (this.x - this.radius < 0) {
                    this.x = this.radius;
                }
                if (this.x + this.radius > canvas.width) {
                    this.x = canvas.width - this.radius;
                }
                if (this.y - this.radius < 0) {
                    this.y = this.radius;
                }
                if (this.y + this.radius > canvas.height) {
                    this.y = canvas.height - this.radius;
                }
            }
        }

        const hole = {
            x: canvas.width - 50,
            y: canvas.height / 2,
            radius: 25,

            draw: function() {
                ctx.save();
                ctx.translate(this.x, this.y);
                
                ctx.beginPath();
                ctx.arc(0, 0, this.radius, 0, Math.PI * 2)
                ctx.fillStyle = 'black';
                ctx.fill();

                ctx.restore();
            },
        };

        function isInHole(ball) {
            const distance = Math.sqrt((ball.x - hole.x) ** 2 + (ball.y - hole.y) ** 2);
            return distance < ball.radius + hole.radius; 
        }

        function updateGame() {
            ctx.fillStyle = "rgb(59, 176, 55)";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ball.update();
            ball.draw();

            hole.draw();

            if (isInHole(ball)) {
                document.getElementById('victory').play();
                endGame();
            }
        }


        class InputHandler {
            constructor(){
                this.keys = [];
                this.touchY = '';
                this.touchTreshold = 30;
                window.addEventListener('touchstart', e => {
                    console.log('Touch Start');
                    this.touchY = e.changedTouches[0].pageY;
                });
                window.addEventListener('touchmove', e => {
                    console.log('Touch Move');
                    const swipeDistance = e.changedTouches[0].pageY - this.touchY;
                    console.log('Swipe Distance:', swipeDistance);
                    if (swipeDistance < -this.touchTreshold && this.keys.indexOf('swipe up') === -1) {
                        this.keys.push('swipe up');
                        ball.move(0, -1);
                    } else if (swipeDistance > this.touchTreshold && this.keys.indexOf('swipe down') === -1) {
                        this.keys.push('swipe down');
                        ball.move(0, 1);
                    }
                });
                window.addEventListener('touchend', e => {
                    console.log('Touch End');
                    ball.move(0, 0);
                });
            }
        }

        function toggleFullScreen() {
            console.log(document.fullscreenElement);
            if (!document.fullscreenElement) {
                canvas.requestFullscreen().catch(err => {
                    alert(`Error, can't enable fullscreen mode: ${err.message}`)
                });
            } else {
                document.exitFullscreen();
            }
        }
        fullScreenButton.addEventListener('click', toggleFullScreen);

        function endGame() {
            gameOver = true;
            window.cancelAnimationFrame(updateGame);
            ctx.font = '30px Times New Roman';
            ctx.fillStyle = 'white';
            ctx.fillText('Leik lokiÃ°!', canvas.width / 2 - 80, canvas.height / 2);
        }

        function gameLoop(timestamp) {
            if (!lastTime) lastTime = timestamp;
            const deltaTime = timestamp - lastTime

            updateGame(deltaTime);
            lastTime = timestamp;

            if (!gameOver) {
                window.requestAnimationFrame(gameLoop);
            }
        }

        if ('orientation' in screen && 'lock' in screen.orientation) {
            screen.orientation.lock('landscape').catch(err => {
                console.error(`Error locking screen orientation: ${err.message}`);
            });
        } else {
            console.warn("Screen orientation lock not supported on this device.");
        }
        
        gameLoop()
    </script>
</body>
</html>
